---
/**
 * ResearchCard - Question number, question, exploration, literature, sub-questions, tags
 * Number label uses JetBrains Mono, cyan/accent color
 * Supports markdown-style content with bold and links
 */

type QuestionNumber = 'Q1' | 'Q2' | 'Q3';

interface Props {
  number: QuestionNumber;
  question: string;
  exploration: string;
  literature?: string[];
  subQuestions?: string[];
  tags: string[];
  class?: string;
}

const {
  number,
  question,
  exploration,
  literature = [],
  subQuestions = [],
  tags = [],
  class: className = ''
} = Astro.props;

const cardClass = [
  'glass-card p-6 md:p-8',
  className
].filter(Boolean).join(' ');

// Simple markdown parser for bold, links, and paragraphs
function parseMarkdown(text: string): string {
  return text
    // Convert **text** to <strong>text</strong>
    .replace(/\*\*(.+?)\*\*/g, '<strong class="text-text-secondary font-semibold">$1</strong>')
    // Convert [text](url) to <a>text</a>
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" class="text-accent hover:text-accent-light underline underline-offset-2" target="_blank" rel="noopener noreferrer">$1</a>')
    // Convert newlines to paragraphs
    .split('\n\n')
    .map(p => p.trim())
    .filter(p => p.length > 0)
    .map(p => `<p class="text-text-muted leading-relaxed mb-4 last:mb-0">${p}</p>`)
    .join('');
}
---

<article class={cardClass}>
  <!-- Number label with JetBrains Mono, cyan color -->
  <div class="font-mono text-accent text-sm font-semibold mb-3">
    {number}
  </div>

  <!-- Question as bold title -->
  <h3 class="text-lg md:text-xl font-bold text-text-primary mb-4 font-display leading-snug">
    {question}
  </h3>

  <!-- Exploration content with markdown rendering -->
  <div class="exploration-content mb-5" set:html={parseMarkdown(exploration)} />

  <!-- Related Literature -->
  {literature.length > 0 && (
    <div class="mb-5 p-4 bg-bg-surface rounded-lg border border-border">
      <h4 class="text-xs font-semibold text-text-subtle uppercase tracking-wider mb-3">Related Literature</h4>
      <ul class="space-y-2">
        {literature.map((ref) => (
          <li class="text-sm text-text-muted flex items-start gap-2">
            <span class="text-accent mt-1.5 flex-shrink-0">â€¢</span>
            <span set:html={parseMarkdown(ref)} />
          </li>
        ))}
      </ul>
    </div>
  )}

  <!-- Open Sub-Questions -->
  {subQuestions.length > 0 && (
    <div class="mb-5">
      <h4 class="text-xs font-semibold text-text-subtle uppercase tracking-wider mb-3">Open Questions</h4>
      <ul class="space-y-2">
        {subQuestions.map((sq) => (
          <li class="text-sm text-text-muted flex items-start gap-2">
            <span class="text-accent-light mt-1 flex-shrink-0">?</span>
            <span>{sq}</span>
          </li>
        ))}
      </ul>
    </div>
  )}

  <!-- Tags at bottom -->
  {tags.length > 0 && (
    <div class="flex flex-wrap gap-2">
      {tags.map((tag) => (
        <span class="badge-subtle text-xs px-2.5 py-0.5 rounded-full">
          {tag}
        </span>
      ))}
    </div>
  )}
</article>
