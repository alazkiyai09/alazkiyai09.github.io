---
/**
 * ProgressRing component - Circular progress indicator
 * @progress number (0-100)
 * @size number (px)
 * @strokeWidth number (px)
 * @showLabel boolean
 */

interface Props {
  progress: number;
  size?: number;
  strokeWidth?: number;
  showLabel?: boolean;
  label?: string;
  class?: string;
}

const {
  progress,
  size = 120,
  strokeWidth = 12,
  showLabel = true,
  label,
  class: className = ''
} = Astro.props;

// Validate inputs
if (strokeWidth >= size) {
  throw new Error(`ProgressRing: strokeWidth (${strokeWidth}) must be less than size (${size})`);
}

const normalizedProgress = Math.min(100, Math.max(0, progress));
const radius = (size - strokeWidth) / 2;
const circumference = 2 * Math.PI * radius;
const offset = circumference - (normalizedProgress / 100) * circumference;

// Generate unique gradient ID for this instance
const gradientId = `progress-gradient-${Math.random().toString(36).substr(2, 9)}`;
---

<div class={`relative inline-flex items-center justify-center ${className}`} style={`width: ${size}px; height: ${size}px;`}>
  <svg class={`transform -rotate-90`} width={size} height={size}>
    <!-- Background circle -->
    <circle
      cx={size / 2}
      cy={size / 2}
      r={radius}
      fill="none"
      class="stroke-slate-200 dark:stroke-slate-700"
      stroke-width={strokeWidth}
    />

    <!-- Progress circle -->
    <circle
      cx={size / 2}
      cy={size / 2}
      r={radius}
      fill="none"
      class="stroke-blue-500 transition-all duration-500 ease-out"
      stroke-width={strokeWidth}
      stroke-dasharray={circumference}
      stroke-dashoffset={offset}
      stroke-linecap="round"
    />

    <!-- Gradient definition -->
    <defs>
      <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#3b82f6" />
        <stop offset="100%" stop-color="#8b5cf6" />
      </linearGradient>
    </defs>
  </svg>

  <!-- Label in center -->
  {showLabel && (
    <div class="absolute inset-0 flex flex-col items-center justify-center">
      <span class="text-2xl font-bold text-slate-900 dark:text-white">
        {Math.round(normalizedProgress)}%
      </span>
      {label && (
        <span class="text-xs text-slate-600 dark:text-slate-400">{label}</span>
      )}
    </div>
  )}
</div>

<style define:vars={{ gradientId }}>
  svg circle:last-child {
    stroke: url(#var(--gradientId));
  }
</style>
